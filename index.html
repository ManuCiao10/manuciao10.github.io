<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="">
<head>
    <title>Manuciao's website</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://manuciao10.github.io/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="https://manuciao10.github.io/theme/css/font-awesome.min.css" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <link href="https://manuciao10.github.io/theme/css/pygments/vs.css" rel="stylesheet">
    <link rel="stylesheet" href="https://manuciao10.github.io/theme/css/style.css" type="text/css"/>

    <link href="data:image/x-icon;base64,AAABAAEAEBAAAAAAAABoBQAAFgAAACgAAAAQAAAAIAAAAAEACAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAQAAAAIAAAADAAAAAwADAAQAAwAXFhUAAQABAAIAAQADAAEABAABAAIBAAAEAQMAAQACAAIAAgADAAIAAgEBAAMBAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAggBAAgICQcJCAgICgkIDAcGBwICAgIJCQgICAkIAw8HCAcDCAIIAQgICQIJAgIJCAIHCAIQAggCEAEICAIDAwEICAIBAAIJAgIDAwMICgkJAggJCAgICAkJAggQAwIJCAgCAgIJAgEIAgEBCQMICgEIAgICAggJBwECAg8IEAQCCAgHCQIIAgIIEAgDCAgJCAEBAAgCEQICAQECAgIJBwgBCAcBAQgCCAEABwECCQIIAggCCAgIAggCBwICCQcDAgMCCAIBAwICAQMJCQkJCgMHBwgCAgICAggLEAgIAggICA8IDQkODwgJAgkJDw8FCAgCEAgICAgIDggCCQ4PCQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=" rel="icon" type="image/x-icon">

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://manuciao10.github.io/" class="navbar-brand">
                <img src="https://manuciao10.github.io/img/favicon.ico" width="32" height="32" alt=""/>
                Manuciao's website            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="https://manuciao10.github.io/pages/about">
                        <i class="fa fa-question"></i>
                        <span class="icon-label">About</span>
                    </a>
                </li>
                <li>
                    <a href="https://manuciao10.github.io/pages/projects">
                        <i class="fa fa-github"></i>
                        <span class="icon-label">Projects</span>
                    </a>
                </li>
                <li>
                    <a href="https://manuciao10.github.io/archives/all">
                        <i class="fa fa-th-list"></i>
                        <span class="icon-label">Archives</span>
                    </a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<div class="container">
    <div class="row">
        <article>
            <h1><a href="https://manuciao10.github.io">Deobfuscation Akamai Bot Manager 2.0</a>
            </h1>

            <span class="published">
                <i class="fa fa-calendar"></i>
                <time> February 22, 2024 at 18:24</time>
            </span>
            <br/><br/>

            <div class="entry-content">
                <p>This post is about analyzing the Akamai JavaScript obfuscated file using developer tools to debug the code. We will then use <tt class="docutils literal"><span class="pre">Golang</span></tt> to create a cookie generator to bypass the bot manager. It is a very basic guide, mostly for beginners. Keep in mind that the script makes some minimal changes every week.
                    To have a better understanding of the Akamai bot manager, you can read <a href="https://www.blackhat.com/docs/eu-17/materials/eu-17-Shuster-Passive-Fingerprinting-Of-HTTP2-Clients-wp.pdf">here.</a></p>

                <h2>Flow</h2>
                <p>1. GET request is made to retrieve the JS script, and the <tt class="docutils literal"><span class="pre">_abck</span></tt> cookie is assigned to the session. If the cookie is invalidated (contains ~0~), it is necessary to submit the sensor again.</p>
                <p>2. Generate valid <tt class="docutils literal"><span class="pre">sensor_data</span></tt>.</p>
                <p>3. POST request to the endpoint script with the generated <tt class="docutils literal"><span class="pre">sensor_data</span></tt> </p>
                <p>4. Repeat steps 2 and 3 three times (or fewer if you have already generated valid cookies).</p>

                <h2>Analysis</h2>
                <p>First of all, we are going to take a part of the <a href="https://www.nike.com/DkzoV9/i7g8c/3YT10/aAs1/YGiYGDwJLS/blxfOQE/C3xRDy0j/Un4">Akamai URL</a> to set a breakpoint, easily recognizable by the developer tools for its sequence of alphanumeric characters separated by forward slashes.</p>
                <img class="align-center" src="img/akamai-url.png" alt="">

                <p>Then, we are going to set a breakpoint in the script, and as you can see in the image below, the variable <tt class="docutils literal"><span class="pre">bW</span></tt> is what we are looking for.</p>
                <img class="align-center" src="img/breakpoint.png" alt="">

                <p>We are now going to the first initialization of <tt class="docutils literal"><span class="pre">bW</span></tt> and printing its value.
                    This value is generated by looping through each element of the <tt class="docutils literal"><span class="pre">AH</span></tt> array and adding a separator, in this test case it will be <tt class="docutils literal"><span class="pre">,019>,447,738AA,049,o983,</span></tt>.
                    Keep in mind that it will change every time.
                </p>
                <img class="align-center" src="img/bW.png" alt="">

                <p>Most of the values are hardcoded (like <tt class="docutils literal"><span class="pre">-100</span></tt> or <tt class="docutils literal"><span class="pre">-105</span></tt>), while others are obtained from <tt class="docutils literal"><span class="pre">window.screen</span></tt>, <tt class="docutils literal"><span class="pre">navigator</span></tt>, and <tt class="docutils literal"><span class="pre">navigator.plugin</span></tt>.
                    To consult all the window instance properties, you can read <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window">here.</a></p>
                <img class="align-center" src="img/ah.png" alt="">
                <p>- <tt class="docutils literal"><span class="pre">window.navigator.userAgent</span></tt> : Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36 </p>
                <p>- <tt class="docutils literal"><span class="pre">window.screen</span></tt> : {availWidth: 450, availHeight: 942, width: 450, height: 942, colorDepth: 30, …} </p>
                <img class="align-center" src="img/compared.png " alt="">
            </div>
        </article>
    </div>
</div>
<footer>
    <div class="container">
        <hr>
        <div class="row">
            <div class="col-xs-10">
                &copy; 2024 Manuciao
            </div>
            <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
        </div>
    </div>
</footer>
</body>
</html>